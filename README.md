# REST and SOAP WS Lab

## Basic Functions

1. There are two parts in this project, a local **Intermediary Web Service** that expose a WS-SOAP API to clients to access to the Velib Web Service and a **Client Application**.
2. The IWS API provides three services:
   * GetHelp: The client can get some instructions on how to use this client application
   * GetStationsOfACity: The client input the name of a city, then he can get all the names of the Velib stations in this city
   * GetStationInfo: The client input the name of a city and the name of a station, then he can get the full information of this station
3. This service can distinguish the errors of the input of the client (the name of the city or of the station doesn't exist etc).

## Extensions

1. **A GUI client application**

   This GUI is simple but clear. The client can choose a service, input the required information and get the result from WS server.

2. **All the accesses are asynchronous**

   For the accesses between IWS and Velib WS, I used `await request.GetResponseAsync();` to get async response, and return a Task \<string> to client. The method is also async.

   For the accesses between IWS and WS Client, I used the asynchronous methods generated by WCF reference in WS Client. For exemple, for the service **GetStationInfo**, I added an Event to the GetStationStationInfoCompleted:

   ```c#
   client.GetStationInfoCompleted += delegate (object sender, GetStationInfoCompletedEventArgs args)
   {
   	result = args.Result; //Get the result from server
   	CreateResultPanel(); //Update the GUI to show the result
   };
   ```

   When the client click the confirm button:

   ```c#
   client.GetStationInfoAsync(cityTextBox.Text, stationTextBox.Text); //cityTextBox.Text is the name of the city, stationTextBox.Text is the name of the station
   ```

   The client waits for the result. If this action is completed, the GUI will show the result.

3. **Add a cache in IWS**

   To add a cache, I've created two MemoryCache in IWS, one for the information of the cities and another for the information of the stations. Every time the client sends a request, the IWS will check if the result to the request is in the cache, if so, IWS will send this result to the client, if not, IWS will connect to Velib WS to get the information and add the information in the cache for the same request. The policy for these cache is SlidingExpiration, the cache will be saved for 30 minutes.

   ```c#
   ObjectCache cacheCity;
   ObjectCache cacheStation;
   CacheItemPolicy policy;

   ...
       
   cacheCity = MemoryCache.Default;
   cacheStation = MemoryCache.Default;
   policy = new CacheItemPolicy();
   policy.SlidingExpiration = new TimeSpan(0, 30, 0);

   ...
       
   if (cacheStation[station] != null)
   {
   	return (string)cacheStation[station];
   }

   ...
       
   cacheStation.Set(station, a.ToString(), policy);

   ...
   ```

   â€‹
